<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</title>
<style>
body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
#gameBox { background: white; margin: 40px auto; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 90%; max-width: 400px; }
button { margin: 8px; padding: 10px 18px; font-size: 18px; border-radius: 10px; cursor: pointer; }
.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }
</style>
</head>
<body>

<div id="gameBox">
  <h1>ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</h1>
  <p id="question">ã“ã“ã«å•é¡ŒãŒå‡ºã‚‹ã‚ˆ</p>
  <div id="choices">
    <button id="primeBtn">ç´ æ•°ï¼</button>
    <button id="notPrimeBtn">ç´ æ•°ã˜ã‚ƒãªã„ï¼</button>
  </div>
  <p id="result"></p>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzbHEci7i40vWCO4vCyjHHrlmm_euJhibuXorhf6o6yNF617qCgzer8MF8u8R5X48CX/exec";

const TOTAL_QUESTIONS = 10;
const MIN_DIGITS = 4;
const MAX_DIGITS = 6;

let questions = [];
let currentIndex = 0;
let correctCount = 0;
let results = [];
let currentNumber;

// ç´ æ•°åˆ¤å®š
function isPrime(n){
  if(n<2) return false;
  for(let i=2;i<=Math.sqrt(n);i++){
    if(n%i===0) return false;
  }
  return true;
}

// 4ã€œ6æ¡å¥‡æ•°ç”Ÿæˆ
function genRandomOdd(){
  const digits = Math.floor(Math.random()*(MAX_DIGITS-MIN_DIGITS+1)) + MIN_DIGITS;
  const min = Math.pow(10,digits-1);
  const max = Math.pow(10,digits)-1;
  let n;
  do { n = Math.floor(Math.random()*(max-min+1))+min; } while(n%2===0);
  return n;
}

// å•é¡Œä½œæˆï¼ˆç´ æ•°4ã€œ6å€‹ã€åˆè¨ˆ10å•ï¼‰
function createQuestions(){
  let primes=[], nonPrimes=[];
  while(primes.length<4){
    let n=genRandomOdd();
    if(isPrime(n) && !primes.includes(n)) primes.push(n);
  }
  while(primes.length<4+Math.floor(Math.random()*3)){
    let n=genRandomOdd();
    if(isPrime(n) && !primes.includes(n)) primes.push(n);
  }
  while(primes.length+nonPrimes.length<TOTAL_QUESTIONS){
    let n=genRandomOdd();
    if(!isPrime(n) && !nonPrimes.includes(n)) nonPrimes.push(n);
  }
  questions = primes.concat(nonPrimes).map(n=>({number:n,isPrime:isPrime(n)}));
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  for(let i=questions.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [questions[i],questions[j]]=[questions[j],questions[i]];
  }
}

// æ¬¡ã®å•é¡Œè¡¨ç¤º
function showNext(){
  document.getElementById("result").textContent="";
  if(currentIndex>=TOTAL_QUESTIONS){
    document.getElementById("question").textContent="ã‚²ãƒ¼ãƒ çµ‚äº†ï¼";
    document.getElementById("choices").style.display="none";
    sendResultsEmail(); // 10å•ã¾ã¨ã‚ã¦é€ä¿¡
    return;
  }
  currentNumber = questions[currentIndex].number;
  document.getElementById("question").textContent=`ã“ã®æ•°å­—ã€Œ${currentNumber}ã€ã¯ç´ æ•°ã‹ãªï¼Ÿ`;
  document.getElementById("choices").style.display="block";
}

// å›ç­”å‡¦ç†
function answer(isPrimeAnswer){
  const correct = questions[currentIndex].isPrime===isPrimeAnswer;
  if(correct) correctCount++;
  results.push({
    questionIndex: currentIndex+1,
    number: currentNumber,
    playerAnswer: isPrimeAnswer?"ç´ æ•°":"ç´ æ•°ã˜ã‚ƒãªã„",
    resultText: correct?"Correct":"Wrong"
  });
  document.getElementById("result").textContent = `${correct?"æ­£è§£ï¼":"æ®‹å¿µğŸ’¦"} (${correctCount}/${currentIndex+1})`;
  document.getElementById("choices").style.display="none";

  currentIndex++;
  setTimeout(showNext, 700);
}

// ã¾ã¨ã‚ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡
function sendResultsEmail(){
  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(results)
  }).catch(err=>console.warn("é€ä¿¡å¤±æ•—:",err));
}

// ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById("primeBtn").addEventListener("click",()=>answer(true));
document.getElementById("notPrimeBtn").addEventListener("click",()=>answer(false));

// åˆæœŸåŒ–
createQuestions();
showNext();
</script>
</body>
</html>
